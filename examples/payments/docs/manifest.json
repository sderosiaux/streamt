{
  "project": "payments-pipeline",
  "sources": [
    {
      "name": "payments_raw",
      "description": "Raw payment events from external system",
      "topic": "payments.raw.v1",
      "cluster": null,
      "schema_": null,
      "owner": null,
      "tags": [],
      "columns": [],
      "freshness": null
    }
  ],
  "models": [
    {
      "name": "payments_clean",
      "description": "Cleaned and validated payment events",
      "materialized": "topic",
      "topic": {
        "name": null,
        "partitions": 6,
        "replication_factor": 3,
        "config": {}
      },
      "key": null,
      "from_": null,
      "sql": "SELECT\n  payment_id,\n  customer_id,\n  amount,\n  currency,\n  status,\n  event_timestamp\nFROM {{ source(\"payments_raw\") }}\nWHERE status IS NOT NULL\n",
      "owner": null,
      "tags": [],
      "access": "private",
      "group": null,
      "version": null,
      "deprecation": null,
      "security": null,
      "flink_cluster": null,
      "flink": null,
      "connect_cluster": null,
      "sink": null
    },
    {
      "name": "customer_balances",
      "description": "Aggregated customer balances per 5-minute window",
      "materialized": "flink",
      "topic": {
        "name": null,
        "partitions": 12,
        "replication_factor": null,
        "config": {}
      },
      "key": null,
      "from_": null,
      "sql": "SELECT\n  customer_id,\n  SUM(amount) as total_amount,\n  COUNT(*) as transaction_count,\n  TUMBLE_END(event_timestamp, INTERVAL '5' MINUTE) as window_end\nFROM {{ ref(\"payments_clean\") }}\nWHERE status = 'CAPTURED'\nGROUP BY customer_id, TUMBLE(event_timestamp, INTERVAL '5' MINUTE)\n",
      "owner": null,
      "tags": [],
      "access": "private",
      "group": null,
      "version": null,
      "deprecation": null,
      "security": null,
      "flink_cluster": null,
      "flink": null,
      "connect_cluster": null,
      "sink": null
    }
  ],
  "tests": [
    {
      "name": "payments_schema",
      "model": "payments_clean",
      "type": "schema",
      "assertions": [
        {
          "not_null": {
            "columns": [
              "payment_id",
              "customer_id",
              "amount"
            ]
          }
        },
        {
          "accepted_values": {
            "column": "status",
            "values": [
              "PENDING",
              "CAPTURED",
              "FAILED",
              "REFUNDED"
            ]
          }
        }
      ],
      "sample_size": null,
      "flink_cluster": null,
      "on_failure": null
    }
  ],
  "exposures": [
    {
      "name": "billing_service",
      "type": "application",
      "role": "consumer",
      "description": "Billing microservice consuming customer balances",
      "owner": "billing-team@example.com",
      "url": null,
      "repo": null,
      "language": null,
      "tool": null,
      "produces": [],
      "consumes": [
        {
          "source": null,
          "ref": "customer_balances"
        }
      ],
      "depends_on": [],
      "consumer_group": "billing-service-consumer",
      "sla": null,
      "contracts": null,
      "access": null,
      "freshness": null,
      "schedule": null,
      "data_requirements": null
    }
  ],
  "dag": {
    "nodes": [
      {
        "name": "payments_raw",
        "type": "source",
        "materialized": null,
        "upstream": [],
        "downstream": [
          "payments_clean"
        ]
      },
      {
        "name": "payments_clean",
        "type": "model",
        "materialized": "topic",
        "upstream": [
          "payments_raw"
        ],
        "downstream": [
          "customer_balances"
        ]
      },
      {
        "name": "customer_balances",
        "type": "model",
        "materialized": "flink",
        "upstream": [
          "payments_clean"
        ],
        "downstream": [
          "billing_service"
        ]
      },
      {
        "name": "billing_service",
        "type": "exposure",
        "materialized": null,
        "upstream": [
          "customer_balances"
        ],
        "downstream": []
      }
    ],
    "edges": [
      {
        "from": "payments_raw",
        "to": "payments_clean"
      },
      {
        "from": "payments_clean",
        "to": "customer_balances"
      },
      {
        "from": "customer_balances",
        "to": "billing_service"
      }
    ]
  }
}